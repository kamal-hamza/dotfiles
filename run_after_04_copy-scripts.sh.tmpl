#!/bin/bash
# This script copies the appropriate scripts based on the operating system

set -e

{{ if or (eq .chezmoi.os "linux") (eq .chezmoi.os "darwin") -}}
# Unix-like systems (Linux and macOS)
echo "› Setting up Unix scripts..."

SOURCE_DIR="{{ .chezmoi.sourceDir }}/.script_sources/on-unix"
DEST_DIR="$HOME/.config/scripts"

# Create the destination directory
mkdir -p "$DEST_DIR"

# Check if source directory exists
if [ -d "$SOURCE_DIR" ]; then
    # Copy all files from the source directory
    cp -r "$SOURCE_DIR"/* "$DEST_DIR/" 2>/dev/null || true

    # Make all files executable
    find "$DEST_DIR" -type f -exec chmod +x {} \;

    echo "✅ Copied Unix scripts to $DEST_DIR"
    echo "✅ Made all scripts executable"
else
    echo "⚠️  Warning: Source directory $SOURCE_DIR not found"
fi
{{ end -}}

{{ if eq .chezmoi.os "windows" -}}
# Windows system
echo "› Setting up Windows scripts..."

$sourceDir = "{{ .chezmoi.sourceDir }}\.script_sources\on-windows"
$destDir = "$env:USERPROFILE\.config\scripts"

# Create destination directory
New-Item -ItemType Directory -Force -Path $destDir | Out-Null

# Check if source directory exists and copy files
if (Test-Path $sourceDir) {
    Copy-Item -Path "$sourceDir\*" -Destination $destDir -Recurse -Force
    Write-Host "✅ Copied Windows scripts to $destDir"
} else {
    Write-Host "⚠️ Warning: Source directory $sourceDir not found"
}
{{ end -}}
