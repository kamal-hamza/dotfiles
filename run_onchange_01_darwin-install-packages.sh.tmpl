{{ if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# Install Homebrew if it's not already installed
if ! command -v brew &> /dev/null; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

# Clean up any existing Meslo Nerd Fonts to avoid conflicts
echo "Cleaning up old Meslo Nerd Fonts..."
rm -f ~/Library/Fonts/MesloLGMNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGSDZNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGSNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGLDZNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGLNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGMDZNerdFont*.ttf
rm -f ~/Library/Fonts/MesloLGLDZNerdFontPropo*.ttf
rm -f ~/Library/Fonts/MesloLGLNerdFontPropo*.ttf
rm -f ~/Library/Fonts/MesloLGMDZNerdFontPropo*.ttf
rm -f ~/Library/Fonts/MesloLGSDZNerdFontPropo*.ttf
rm -f ~/Library/Fonts/MesloLGSNerdFontPropo*.ttf

# Install packages from the Brewfile template
brew bundle --file=/dev/stdin <<EOF
{{ range .packages.darwin.brews -}}
brew {{ . | quote }}
{{ end -}}
{{ range .packages.darwin.casks -}}
cask {{ . | quote }}
{{ end -}}
EOF
{{ end -}}
