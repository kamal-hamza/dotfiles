# =============================================================================
# Simple Cross-Platform Zsh Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Helper Functions
# -----------------------------------------------------------------------------
source_if_exists() {
  [[ -f "$1" && -r "$1" ]] && source "$1"
}

# -----------------------------------------------------------------------------
# Homebrew Setup (macOS)
# -----------------------------------------------------------------------------
if [[ "$OSTYPE" == "darwin"* ]]; then
  if [[ -x /opt/homebrew/bin/brew ]]; then
    eval "$(/opt/homebrew/bin/brew shellenv)"
  elif [[ -x /usr/local/bin/brew ]]; then
    eval "$(/usr/local/bin/brew shellenv)"
  fi
fi

# -----------------------------------------------------------------------------
# Zsh Completion System
# -----------------------------------------------------------------------------
autoload -Uz compinit
compinit -C

# -----------------------------------------------------------------------------
# Load Theme
# -----------------------------------------------------------------------------
# Load current theme colors (dark by default)
CURRENT_THEME="dark"
if [[ -f "$HOME/.config/.current-theme" ]]; then
    CURRENT_THEME=$(cat "$HOME/.config/.current-theme")
fi
source_if_exists "$HOME/.config/zsh/themes/soft-focus-${CURRENT_THEME}.zsh"

# -----------------------------------------------------------------------------
# Simple Prompt
# -----------------------------------------------------------------------------
autoload -Uz vcs_info
precmd() { vcs_info }
zstyle ':vcs_info:git:*' formats '(%b) '
zstyle ':vcs_info:*' enable git
setopt PROMPT_SUBST
PROMPT='%1~ ${vcs_info_msg_0_}%% '

# -----------------------------------------------------------------------------
# Zsh Plugins
# -----------------------------------------------------------------------------
# macOS (Homebrew)
if [[ "$OSTYPE" == "darwin"* ]]; then
  brew_share="${HOMEBREW_PREFIX:-/opt/homebrew}/share"
  source_if_exists "$brew_share/zsh-autosuggestions/zsh-autosuggestions.zsh"
  source_if_exists "$brew_share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  source_if_exists "$brew_share/zsh-autopair/autopair.zsh"
fi

# Arch Linux (Pacman)
if [[ "$OSTYPE" == "linux-gnu"* ]]; then
  source_if_exists "/usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh"
  source_if_exists "/usr/share/zsh-autosuggestions/zsh-autosuggestions.zsh"
  source_if_exists "/usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  source_if_exists "/usr/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"
  source_if_exists "/usr/share/zsh/plugins/zsh-autopair/autopair.zsh"
  source_if_exists "/usr/share/zsh-autopair/autopair.zsh"
fi

# -----------------------------------------------------------------------------
# FZF Integration
# -----------------------------------------------------------------------------
if command -v fzf >/dev/null 2>&1; then
  source <(fzf --zsh)
fi

# -----------------------------------------------------------------------------
# Aliases
# -----------------------------------------------------------------------------
alias v="nvim"
alias vi="nvim"
alias t="tmux attach"
alias cls="clear"

# -----------------------------------------------------------------------------
# Script Aliases
# -----------------------------------------------------------------------------
source_if_exists "$HOME/.config/zsh/aliases.zsh"

# -----------------------------------------------------------------------------
# History Configuration
# -----------------------------------------------------------------------------
HISTFILE="$HOME/.zsh_history"
HISTSIZE=10000
SAVEHIST=10000
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_FIND_NO_DUPS
setopt SHARE_HISTORY